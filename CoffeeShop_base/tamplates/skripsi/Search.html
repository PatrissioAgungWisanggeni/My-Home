{% extends 'base.html' %}

{% block content %}
<div class="px-28 min-h-screen flex flex-col">
  <div class="flex-grow">
    <img src="/media/image/Frame 34923.png" alt="logo" class="mx-auto d-block my-4" />
    <hr style="border-color: #B16E39; border-width: 9px;" />
    <section>
      <div>
        <form class="grid grid-cols-7">
          <div class="relative col-span-6">
            <input type="search" name="cari" value="{{ request.GET.cari }}"
              class="border border-5 text-xl rounded-lg w-full h-full" placeholder="Mau Kemana ..." />
            <i class="fa-solid fa-magnifying-glass absolute right-7 top-3 text-3xl opacity-60"></i>
          </div>
          <button type="submit" style="background-color:#B16E39 ;"
            class="text-white rounded-xl text-xl ml-auto w-40 h-14"><b>Cari</b></button>
        </form>
      </div>
      <div class="my-7">
        <div class="flex">
          <svg width="50" heigh="50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 150 150">
            <path fill="#1a73e8"
              d="M89.77,10.4c-4.4-1.39-9.08-2.15-13.94-2.15c-14.18,0-26.87,6.41-35.33,16.48l21.8,18.34L89.77,10.4z" />
            <path fill="#ea4335"
              d="M40.49,24.73c-6.74,8.02-10.81,18.37-10.81,29.66c0,8.68,1.73,15.71,4.57,22.01l28.04-33.33L40.49,24.73z" />
            <path fill="#4285f4" d="M75.83,36.75c9.75,0,17.65,7.9,17.65,17.65c0,4.34-1.57,8.32-4.17,11.39c0,0,13.94-16.58,27.47-32.66
                        c-5.59-10.75-15.28-19.02-27-22.73L62.29,43.07C65.53,39.2,70.39,36.75,75.83,36.75" />
            <path fill="#fbbc04" d="M75.83,72.04c-9.75,0-17.65-7.9-17.65-17.65c0-4.31,1.55-8.26,4.11-11.33L34.25,76.4
                        c4.79,10.63,12.76,19.16,20.97,29.91L89.3,65.79C86.07,69.61,81.23,72.04,75.83,72.04" />
            <path fill="#34a853"
              d="M88.63,117.37c15.39-24.07,33.34-35,33.34-62.98c0-7.67-1.88-14.9-5.19-21.26l-61.55,73.18
                        c2.61,3.42,5.24,7.06,7.81,11.07c9.36,14.46,6.76,23.13,12.8,23.13C81.86,140.51,79.27,131.83,88.63,117.37" />
          </svg>
          <button style="background-color:#B16E39;" class="text-white rounded-xl w-96 h-14 text-2xl"
            onclick="toggleLocationInputs()">Temukan Coffee Shop Terdekat</button>

          <button onclick="toggleSemua()"
            style="background-color:#B16E39; justify-content: center; align-items: center;"
            class="text-white rounded-xl w-60 h-14 text-2xl ml-auto flex gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="45"
              height="45" viewBox="0 0 256 256" xml:space="preserve">
              <defs>
              </defs>
              <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;"
                transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)">
                <path
                  d="M 69.416 43.298 H 68.97 c -0.983 0 -1.917 0.216 -2.756 0.603 c -0.644 -2.975 -3.295 -5.21 -6.459 -5.21 h -0.447 c -1.128 0 -2.19 0.284 -3.12 0.784 c -1 -2.379 -3.355 -4.054 -6.094 -4.054 h -0.447 c -0.925 0 -1.807 0.191 -2.606 0.536 v -9.458 c 0 -3.644 -2.964 -6.607 -6.608 -6.607 h -0.447 c -3.643 0 -6.607 2.964 -6.607 6.607 v 24.261 l -3.005 2.281 c -2.394 1.817 -3.911 4.461 -4.273 7.444 c -0.362 2.984 0.479 5.914 2.37 8.251 l 9.378 11.594 v 4.608 c 0 2.791 2.271 5.063 5.062 5.063 h 23.411 c 2.791 0 5.063 -2.271 5.063 -5.063 l 0.001 -4.375 c 2.996 -3.766 4.639 -8.438 4.639 -13.242 V 49.905 C 76.023 46.262 73.06 43.298 69.416 43.298 z M 72.023 67.32 c 0 4.102 -1.478 8.088 -4.159 11.224 c -0.311 0.362 -0.48 0.823 -0.48 1.3 v 5.094 c 0 0.586 -0.477 1.063 -1.063 1.063 H 42.911 c -0.585 0 -1.062 -0.477 -1.062 -1.063 v -5.316 c 0 -0.458 -0.157 -0.902 -0.445 -1.258 L 31.581 66.22 c -1.204 -1.488 -1.74 -3.354 -1.509 -5.254 c 0.23 -1.899 1.197 -3.583 2.721 -4.74 l 0.586 -0.444 v 5.495 c 0 1.104 0.896 2 2 2 s 2 -0.896 2 -2 v -9.506 c 0 -0.014 0 -0.026 0 -0.04 V 26.498 c 0 -1.438 1.169 -2.607 2.607 -2.607 h 0.447 c 1.438 0 2.607 1.17 2.607 2.607 v 15.53 c 0 0 0 0 0 0.001 s 0 0 0 0.001 l 0.01 12.917 c 0.001 1.104 0.896 1.998 2 1.998 c 0 0 0.001 0 0.001 0 c 1.104 -0.001 1.999 -0.896 1.998 -2.002 L 47.04 42.028 c 0 -1.438 1.169 -2.607 2.606 -2.607 h 0.447 c 1.438 0 2.607 1.17 2.607 2.607 v 3.27 c 0 0 0 0.001 0 0.001 c 0 0 0 0.001 0 0.001 l 0.009 9.647 c 0.001 1.104 0.896 1.998 2 1.998 c 0.001 0 0.001 0 0.002 0 c 1.104 -0.001 1.999 -0.897 1.998 -2.002 l -0.009 -9.646 c 0 -1.438 1.169 -2.607 2.606 -2.607 h 0.447 c 1.438 0 2.607 1.17 2.607 2.607 v 4.088 c -0.006 0.066 -0.02 0.13 -0.02 0.197 l 0.01 5.366 c 0.002 1.104 0.897 1.996 2 1.996 c 0.001 0 0.002 0 0.004 0 c 1.104 -0.002 1.998 -0.899 1.996 -2.004 l -0.009 -4.852 c 0.006 -0.062 0.019 -0.121 0.019 -0.184 c 0 -1.438 1.17 -2.607 2.607 -2.607 h 0.446 c 1.438 0 2.607 1.17 2.607 2.607 V 67.32 z"
                  style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255, 255, 255); fill-rule: nonzero; opacity: 1;"
                  transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                <path
                  d="M 63.994 25.511 H 51.79 c -1.104 0 -2 -0.896 -2 -2 s 0.896 -2 2 -2 h 12.204 c 1.104 0 2 0.896 2 2 S 65.099 25.511 63.994 25.511 z"
                  style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255, 255, 255); fill-rule: nonzero; opacity: 1;"
                  transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                <path
                  d="M 39.985 16.204 c -1.104 0 -2 -0.896 -2 -2 V 2 c 0 -1.104 0.896 -2 2 -2 s 2 0.896 2 2 v 12.204 C 41.985 15.309 41.09 16.204 39.985 16.204 z"
                  style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255, 255, 255); fill-rule: nonzero; opacity: 1;"
                  transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                <path
                  d="M 48.558 18.441 c -0.512 0 -1.023 -0.195 -1.414 -0.586 c -0.781 -0.781 -0.781 -2.047 0 -2.828 l 8.63 -8.629 c 0.781 -0.781 2.047 -0.781 2.828 0 c 0.781 0.781 0.781 2.047 0 2.828 l -8.63 8.629 C 49.581 18.246 49.069 18.441 48.558 18.441 z"
                  style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255, 255, 255); fill-rule: nonzero; opacity: 1;"
                  transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                <path
                  d="M 28.181 25.511 H 15.977 c -1.104 0 -2 -0.896 -2 -2 s 0.896 -2 2 -2 h 12.204 c 1.104 0 2 0.896 2 2 S 29.285 25.511 28.181 25.511 z"
                  style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255, 255, 255); fill-rule: nonzero; opacity: 1;"
                  transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                <path
                  d="M 31.413 18.441 c -0.512 0 -1.024 -0.195 -1.414 -0.586 L 21.37 9.226 c -0.781 -0.781 -0.781 -2.047 0 -2.828 c 0.78 -0.781 2.048 -0.781 2.828 0 l 8.629 8.629 c 0.781 0.781 0.781 2.047 0 2.828 C 32.437 18.246 31.925 18.441 31.413 18.441 z"
                  style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255, 255, 255); fill-rule: nonzero; opacity: 1;"
                  transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
              </g>
            </svg>
            Lihat Semua</button>
        </div>

        <div class="flex mt-7 hidden" id="locationInputs">
          <form id="distanceForm" method="POST">
            {% csrf_token %}
            <div class="flex">
              <input type="number" step="any" name="latitude" class="border border-5 text-xl rounded-lg h-full"
                placeholder="Latitude Saat Ini ..." />
              <input type="number" step="any" name="longitude" class="border border-5 text-xl rounded-lg h-full mx-3"
                placeholder="Longitude Saat Ini ..." />
              <input type="number" step="any" name="k" class="border border-5 text-xl rounded-lg h-full"
                placeholder="Jumlah yang ditampilkan">
              <button type="submit" id="searchDistance" style="background-color:#B16E39;"
                class="relative text-white rounded-xl w-14 h-9 text-2xl"><i
                  class="fa-solid fa-magnifying-glass absolute top-2 left-4 text-2xl"></i></button>
            </div>
          </form>
        </div>
      </div>
    </section>
    <hr style="border-color: #B16E39; border-width: 9px;" />
    <section>
      {% if not cari and not data_terdekat %}
      <div id="Riwayat">
        <div class="flex my-9">
          <h1>Riwayat</h1>
        </div>
        <div class="ml-10">
          {% for riwayat in riwayats %}
          <div class="grid grid-rows-2">
            <a href="{% url 'detail' id=riwayat.coffee_shop.id %}?from_search=1" class="no-underline text-black">
              <h4>{{ riwayat.coffee_shop.nama }}</h4>
            </a>
            <div class="flex">
              <i class="fa fa-location-dot text-xl"></i>
              <p class="ml-3">{{ riwayat.coffee_shop.alamat }}</p>
              <i type="button" data-bs-toggle="modal" data-bs-target="#modalDelete{{riwayat.id}}"
                class="ml-auto fa-solid fa-trash text-red-500 text-4xl row-span-2"></i>
            </div>
          </div>
          <hr style="border-width: 3px;" />
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <div id="SemuaData" style="display: none;">
        <div class="flex my-9">
          <h1>Semua Coffee Shop</h1>
          <a href="{% url 'delete_favorite' %}" class="ml-auto mt-auto text-xl no-underline">(Hapus Semua Favorite)</a>
        </div>
        <div class="ml-10">
          {% for all_datas in all_data %}
          <div class="grid grid-rows-2">
            <a href="{% url 'detail' id=all_datas.id %}?from_search=1" class="no-underline text-black">
              <h4>{{ all_datas.nama }}</h4>
            </a>
            <div class="flex">
              <i class="fa fa-location-dot text-xl"></i>
              <p class="ml-3">{{ all_datas.alamat }}</p>
              <div class="ml-auto">
              <form action="{% url 'favorite' all_datas.id %}" method="POST">
                {% csrf_token %}
                <button type="submit" class="fa-heart text-4xl row-span-2 {% if all_datas.id in data_favorite %}fa-solid text-red-500 {% else %} fa-regular {% endif %}"></button>
              </form>
              </div>
            </div>
          </div>
          <hr style="border-width: 3px;" />
          {% endfor %}
        </div>
      </div>

      {% if cari %}
      <div id="HasilPencarian">
        <h1 class="my-7">Hasil Pencarian</h1>
        <div class="ml-10">
          {% for data in datas %}
          <div class="grid grid-rows-2">
            <a href="{% url 'detail' id=data.id %}?from_search=1" class="no-underline text-black">
              <h4>{{ data.nama }}</h4>
            </a>
            <div class="flex">
              <i class="fa fa-location-dot text-xl"></i>
              <p class="ml-3">{{ data.alamat }}</p>
            </div>
          </div>
          <hr style="border-width: 3px;" />
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {% if data_terdekat %}
      <div class="my-7" id="Terdekat">
        <h1>Coffee Shop terdekat dari lokasi anda</h1>
        <div class="grid grid-cols-3 gap-16">
          {% for neighbors, jarak in data_terdekat %}
          <div>
            <a href="{% url 'detail' id=neighbors.id %}?from_search=1" class="text-black no-underline">
              <img src="{{ neighbors.gambar }}" class="w-full h-50 object-cover rounded-xl mb-3" />
              <div class="flex my-2">
                <h2>{{ neighbors.nama }}</h2>
                <div class="ml-auto flex pl-3">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30px"
                    height="30px" viewBox="0 0 100 100" aria-hidden="true" role="img" class="iconify iconify--gis"
                    preserveAspectRatio="xMidYMid meet">
                    <path
                      d="M21 32C9.459 32 0 41.43 0 52.94c0 4.46 1.424 8.605 3.835 12.012l14.603 25.244c2.045 2.672 3.405 2.165 5.106-.14l16.106-27.41c.325-.59.58-1.216.803-1.856A20.668 20.668 0 0 0 42 52.94C42 41.43 32.544 32 21 32zm0 9.812c6.216 0 11.16 4.931 11.16 11.129c0 6.198-4.944 11.127-11.16 11.127c-6.215 0-11.16-4.93-11.16-11.127c0-6.198 4.945-11.129 11.16-11.129z"
                      fill="#000000" />
                    <path
                      d="M87.75 0C81.018 0 75.5 5.501 75.5 12.216c0 2.601.83 5.019 2.237 7.006l8.519 14.726c1.193 1.558 1.986 1.262 2.978-.082l9.395-15.99c.19-.343.339-.708.468-1.082a12.05 12.05 0 0 0 .903-4.578C100 5.5 94.484 0 87.75 0zm0 5.724c3.626 0 6.51 2.876 6.51 6.492c0 3.615-2.884 6.49-6.51 6.49c-3.625 0-6.51-2.875-6.51-6.49c0-3.616 2.885-6.492 6.51-6.492z"
                      fill="#000000" />
                    <path
                      d="M88.209 37.412c-2.247.05-4.5.145-6.757.312l.348 5.532a126.32 126.32 0 0 1 6.513-.303zm-11.975.82c-3.47.431-6.97 1.045-10.43 2.032l1.303 5.361c3.144-.896 6.402-1.475 9.711-1.886zM60.623 42.12a24.52 24.52 0 0 0-3.004 1.583l-.004.005l-.006.002c-1.375.866-2.824 1.965-4.007 3.562c-.857 1.157-1.558 2.62-1.722 4.35l5.095.565c.038-.406.246-.942.62-1.446h.002v-.002c.603-.816 1.507-1.557 2.582-2.235l.004-.002a19.64 19.64 0 0 1 2.388-1.256zM58 54.655l-3.303 4.235c.783.716 1.604 1.266 2.397 1.726l.01.005l.01.006c2.632 1.497 5.346 2.342 7.862 3.144l1.446-5.318c-2.515-.802-4.886-1.576-6.918-2.73c-.582-.338-1.092-.691-1.504-1.068zm13.335 5.294l-1.412 5.327l.668.208l.82.262c2.714.883 5.314 1.826 7.638 3.131l2.358-4.92c-2.81-1.579-5.727-2.611-8.538-3.525l-.008-.002l-.842-.269zm14.867 7.7l-3.623 3.92c.856.927 1.497 2.042 1.809 3.194l.002.006l.002.009c.372 1.345.373 2.927.082 4.525l5.024 1.072c.41-2.256.476-4.733-.198-7.178c-.587-2.162-1.707-4.04-3.098-5.548zM82.72 82.643a11.84 11.84 0 0 1-1.826 1.572h-.002c-1.8 1.266-3.888 2.22-6.106 3.04l1.654 5.244c2.426-.897 4.917-1.997 7.245-3.635l.006-.005l.003-.002a16.95 16.95 0 0 0 2.639-2.287zm-12.64 6.089c-3.213.864-6.497 1.522-9.821 2.08l.784 5.479c3.421-.575 6.856-1.262 10.27-2.18zm-14.822 2.836c-3.346.457-6.71.83-10.084 1.148l.442 5.522c3.426-.322 6.858-.701 10.285-1.17zm-15.155 1.583c-3.381.268-6.77.486-10.162.67l.256 5.536c3.425-.185 6.853-.406 10.28-.678zm-15.259.92c-2.033.095-4.071.173-6.114.245l.168 5.541a560.1 560.1 0 0 0 6.166-.246z"
                      fill="#000000" fill-rule="evenodd" />
                  </svg>
                  <span class="ml-2"><b>{{ jarak }} meter</b></span>
                </div>
              </div>
              <div class="flex mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                  stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                </svg>
                <span class="ml-2"><b>{{ neighbors.alamat }}</b></span>
              </div>

              <p class="text-xl text-justify truncate line-clamp-3">{{ neighbors.deskripsi }}</p>
            </a>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </section>
  </div>
</div>


{% for riwayat in riwayats %}
<div class="modal fade" id="modalDelete{{riwayat.id}}">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">{{riwayat.coffee_shop.nama}}</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <h6>Yakin akan menghapus data ini dari Riwayat anda ?</h6>
      </div>
      <!-- Modal footer -->
      <div class="modal-footer">
        <form action="{% url 'delete_riwayat' riwayat.id %}" method="post">
          {% csrf_token %}
          <button class="btn btn-primary" data-bs-dismiss="modal">Tidak</button>
          <button type="submit" class="btn btn-danger">Hapus</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endfor %}

<script>

  function toggleLocationInputs() {
    var locationInputs = document.getElementById('locationInputs')
    if (locationInputs.style.display === 'none') {
      locationInputs.style.display = 'flex'
    } else {
      locationInputs.style.display = 'none'
    }
  }

  function toggleSemua() {
    var riwayat = document.getElementById('Riwayat')
    var semua = document.getElementById('SemuaData')
    var terdekat = document.getElementById('Terdekat')

    if (riwayat.style.display === 'none') {
      riwayat.style.display = 'block'
      semua.style.display = 'none'
    } else {
      riwayat.style.display = 'none'
      semua.style.display = 'block'
    }
  }


  var data_favorite = [];

  function toggleFavorite(id) {
    var favorite = document.getElementById('favorite-' + id);

    if (favorite.classList.contains('fa-solid')) {
      favorite.classList.remove('fa-solid', 'text-red-500');
      favorite.classList.add("fa-regular");
      removeFavorite(id);
    } else {
      favorite.classList.remove('fa-regular');
      favorite.classList.add("fa-solid", 'text-red-500');
      addFavorite(id);
    }
    console.log(data_favorite);
  }

  function addFavorite(id) {
    if (!data_favorite.includes(id)) {
      data_favorite.push(id);
    }
  }

  function removeFavorite(id) {
    var index = data_favorite.indexOf(id);
    if (index > -1) {
      data_favorite.splice(index, 1);
    }
  }

</script>
{% endblock %}